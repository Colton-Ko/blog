import { visit } from 'unist-util-visit';

/**
 * Rehype plugin to add 'mermaid' class to mermaid diagrams generated by rehype-mermaid
 * This allows us to style them (e.g. center them) with CSS.
 */
export default function rehypeMermaidClass() {
    return (tree) => {
        visit(tree, 'element', (node) => {
            if (node.tagName === 'img' && node.properties && node.properties.id) {
                // Check if ID starts with 'mermaid-'
                if (String(node.properties.id).startsWith('mermaid-')) {
                    node.properties.className = node.properties.className || [];
                    if (!Array.isArray(node.properties.className)) {
                        node.properties.className = [node.properties.className];
                    }
                    node.properties.className.push('mermaid');
                }
            }
        });
    };
}
